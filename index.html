<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L'Archipel des Insectes - Exploration Éducative</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet" />

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://cdn.babylonjs.com/materials/babylonjs.materials.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/main.css" />
</head>
<body>

<div id="global-help-modal" class="global-help-modal">
    <div class="help-content">
        <button class="nav-close" onclick="UIManager.toggleGlobalHelp()">×</button>

        <div class="help-header">
            <h2>Guide de l'Explorateur</h2>
            <p>Bienvenue dans l'Archipel. Voici comment mener votre mission à bien.</p>
        </div>

        <div class="help-grid">
            <div class="help-card">
                <div class="help-icon"><i class="fas fa-mouse-pointer"></i></div>
                <h3>Navigation 3D</h3>
                <p><strong>Maintenez le clic gauche</strong> pour tourner autour de l'archipel. Utilisez la <strong>molette</strong> pour zoomer/dézoomer.</p>
            </div>

            <div class="help-card">
                <div class="help-icon"><i class="fas fa-anchor"></i></div>
                <h3>Le Port d'Attache</h3>
                <p>C'est votre hub central. Cliquez sur le <strong>Port ou le Bateau</strong> pour choisir une île et lancer une expédition.</p>
            </div>

            <div class="help-card">
                <div class="help-icon"><i class="fas fa-chart-pie"></i></div>
                <h3>Exploration</h3>
                <p>Survolez les îles pour voir votre progression. Chaque île possède un écosystème unique et des espèces à découvrir.</p>
            </div>

            <div class="help-card">
                <div class="help-icon"><i class="fas fa-book-journal-whills"></i></div>
                <h3>Carnet de Bord</h3>
                <p>Toutes vos découvertes sont enregistrées. Consultez-le via le bouton en bas à gauche pour revoir vos fiches.</p>
            </div>
        </div>

        <button class="btn-primary" style="margin-top: 30px;" onclick="UIManager.toggleGlobalHelp()">
            J'ai compris, à l'aventure !
        </button>
    </div>
</div>

<button class="btn-journal-floating" onclick="ArchipelagoApp.openJournal()" aria-label="Carnet de bord">
    <i class="fas fa-book-journal-whills"></i>
</button>

<button class="btn-help-floating" onclick="UIManager.toggleGlobalHelp()" aria-label="Aide">
    <i class="fas fa-question"></i>
</button>

<button class="btn-settings-floating" onclick="UIManager.toggleSettings()" aria-label="Paramètres">
    <i class="fas fa-cog"></i>
</button>

<div id="settings-modal" class="global-help-modal"> <div class="settings-content">
    <button class="nav-close" onclick="UIManager.toggleSettings()">×</button>

    <div class="settings-header">
        <h2>Paramètres</h2>
        <p>Personnalisez votre expérience de navigation.</p>
    </div>

    <div class="settings-list">
        <div class="setting-item">
            <div class="setting-info">
                <span class="setting-label">Séquence de Navigation</span>
                <span class="setting-desc">Si désactivé, le voyage vers les îles est instantané.</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-boat-anim" checked onchange="GameSettings.toggle('boatAnim')">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <span class="setting-label">Particules Météo</span>
                <span class="setting-desc">Pluie, neige, feuilles et lucioles.</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-particles" checked onchange="GameSettings.toggle('particles')">
                <span class="slider round"></span>
            </label>
        </div>

        <div class="setting-item">
            <div class="setting-info">
                <span class="setting-label">Flottaison des Îles</span>
                <span class="setting-desc">Animation de lévitation sur la carte.</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="toggle-island-anim" checked onchange="GameSettings.toggle('islandAnim')">
                <span class="slider round"></span>
            </label>
        </div>
    </div>
</div>
</div>

<div id="navigation-modal" class="navigation-modal">
    <div class="nav-content">
        <button class="nav-close" onclick="UIManager.closeNavigation()">×</button>
        <h2 style="color: #787a82; margin-bottom: 10px; text-align: left; font-size: 2.2rem">Plan de Navigation</h2>
        <p style="text-align: left; color: #787a82; margin-bottom: 15px;" >Capitaine, quelle est notre prochaine destination ?</p>

        <div class="destinations-grid" id="destinations-grid">
        </div>
    </div>
</div>

<div id="island-confirmation-modal" class="navigation-modal"> <div class="nav-content" style="max-width: 500px;">
    <button class="nav-close" onclick="UIManager.closeIslandConfirmation()">×</button>

    <div class="conf-icon" style="font-size: 3rem; color: #1976d2; margin-bottom: 20px;">
        <i class="fas fa-map-marked-alt"></i>
    </div>

    <h2 id="conf-island-name" style="color: #787a82; margin-bottom: 10px;">Nom de l'île</h2>
    <p style="color: #666; margin-bottom: 30px;">
        Voulez-vous vraiment quitter la carte et lancer une expédition vers cette île ?
    </p>

    <div style="display: flex; gap: 15px; justify-content: center;">
        <button class="btn-secondary" onclick="UIManager.closeIslandConfirmation()">
            Annuler
        </button>
        <button class="btn-primary" id="btn-confirm-explore">
            <i class="fas fa-ship"></i> Oui, mettre le cap !
        </button>
    </div>
</div>
</div>

<div id="return-map-confirmation-modal" class="navigation-modal">
    <div class="nav-content" style="max-width: 500px;">
        <button class="nav-close" onclick="UIManager.closeReturnMapConfirmation()">×</button>

        <div class="conf-icon" style="font-size: 3rem; color: #f44336; margin-bottom: 20px;">
            <i class="fas fa-anchor"></i>
        </div>

        <h2 style="color: #787a82; margin-bottom: 10px;">Lever l'ancre ?</h2>
        <p style="color: #666; margin-bottom: 30px;">
            Voulez-vous quitter l'exploration de cette île pour revenir à la carte de l'archipel ?
        </p>

        <div style="display: flex; gap: 15px; justify-content: center;">
            <button class="btn-secondary" onclick="UIManager.closeReturnMapConfirmation()">
                Rester ici
            </button> <button class="btn-primary" id="btn-confirm-return-map">
            <i class="fas fa-map"></i> Oui, larguer les amarres
        </button>
        </div>
    </div>
</div>

<div id="map-view-screen" class="screen active">
    <canvas id="renderCanvas"></canvas>

    <div class="map-top-bar">
        <div class="map-titles">
            <h1 class="map-title">Archipel de la Biodiversité</h1>
        </div>
    </div>

    <div class="map-left-ui-stack">

        <div class="map-mission-panel">
            <div class="mission-header">
                <h4>Votre Mission</h4>
            </div>
            <p>L'équilibre de l'archipel est menacé. Explorez chaque île pour documenter les espèces clés et comprendre leur rôle dans l'écosystème.
                Chaque espèce découverte sera répertoriée dans votre carnet de bord.
            </p>
            <ul class="mission-steps">
                <li><i class="fas fa-compass"></i> <strong>Naviguez</strong> vers une île pour l'étudier.</li>
                <li><i class="fas fa-magnifying-glass"></i> <strong>Identifiez</strong> les insectes cachés.</li>
                <li><i class="fas fa-book-open"></i> <strong>Complétez</strong> votre base de données.</li>
            </ul>
        </div>
    </div>

    <div class="map-ui-bottom">
        <div class="island-legend">
            <div class="legend-item">
                <span class="legend-color" style="background: #7cb342"></span>
                <span>Zone saine</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #ffa726"></span>
                <span>Étude en cours</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #42a5f5"></span>
                <span>Inventaire terminé</span>
            </div>
        </div>
    </div>

    <div id="island-tooltip" class="island-tooltip">
    </div>
</div>

<div id="boat-travel-screen" class="screen">
    <canvas id="boatCanvas"></canvas>

    <div class="travel-overlay">
        <div class="travel-message">
            <h2 id="travel-text">Cap vers l'île...</h2>

            <p id="travel-quote" class="travel-quote">Chargement des données...</p>

            <div class="wave-animation"></div>
        </div>
    </div>
</div>

<div id="island-exploration-screen" class="screen">
    <canvas id="islandCanvas"></canvas>

    <div id="left-panel" class="side-panel left-panel">
        <div class="panel-header">
            <h3 class="panel-title" id="island-name">Nom de l'île</h3>
            <p class="panel-ecosystem" id="island-ecosystem">Écosystème</p>
        </div>

        <div class="info-section env-container">
            <h4>Analyse du Biome</h4>
            <p id="island-env-desc" class="educational-text">Chargement des données environnementales...</p>
        </div>

        <div class="progress-section">
            <h4>Registre d'Exploration</h4>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p class="progress-text" id="progress-text">0/0 spécimens identifiés</p>
        </div>

        <div class="panel-actions">
            <button class="btn-scanner" onclick="IslandScene.triggerScanner()">
                <i class="fas fa-radar"></i> Révéler les spécimens
            </button>
        </div>
    </div>
</div>

<div id="journal-screen" class="screen">
    <div class="journal-container">
        <button class="journal-close" onclick="ArchipelagoApp.closeJournal()">×</button>

        <h2 class="journal-title">Carnet de Bord Scientifique</h2>
        <p class="journal-subtitle">Base de données des arthropodes découverts</p>

        <div class="journal-grid" id="journal-grid"></div>

        <div class="journal-stats">
            <p><strong>Spécimens collectés :</strong> <span id="total-discovered">0</span> / <span id="total-insects">20</span></p>
            <p><strong>Biomes cartographiés : </strong><span id="islands-explored">0</span> / <span id="total-islands-count">5</span></p>
        </div>
    </div>

    <div class="journal-modal" id="journal-modal">
        <div class="modal-content">
            <button class="journal-close" onclick="JournalManager.closeModal()">×</button>

            <div class="modal-visual">
                <div id="journal-3d-container" style="width:100%; height:100%"></div>
            </div>

            <div class="modal-data">
                <h2 class="panel-title" id="modal-name">Nom</h2>
                <p class="modal-taxonomy" id="modal-taxonomy">Taxonomie</p>
            </div>
        </div>
    </div>
</div>

<div id="interactive-modal" class="navigation-modal">
    <div class="nav-content" style="max-width: 500px; text-align: center;">
        <button class="nav-close" onclick="UIManager.closeInteractiveModal()">×</button>

        <div id="inter-icon" style="font-size: 4rem; margin-bottom: 10px;"></div>
        <h2 id="inter-title" style="color: #5d4037; margin-bottom: 15px;">Titre</h2>

        <p id="inter-text" style="color: #666; font-style: italic; line-height: 1.6; white-space: pre-wrap;">
            Texte...
        </p>
    </div>
</div>

<div id="conclusion-screen" class="victory-overlay">
    <div class="victory-modal">

        <h2 class="conclusion-title">Mission Accomplie</h2>

        <div class="conclusion-message">
        </div>

        <div class="conclusion-stats">
            <div class="stat-item">
                <span class="stat-number" id="final-insects">20</span>
                <span class="stat-label">Identifications</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="final-islands">5</span>
                <span class="stat-label">Îles explorées</span>
            </div>
        </div>

        <button class="btn-primary btn-victory" onclick="ArchipelagoApp.restart()">
            Nouvelle Expédition
        </button>
    </div>
</div>

<div id="right-panel" class="side-panel right-panel">
    <button class="panel-close" onclick="ArchipelagoApp.closeInsectPanel()">×</button>

    <div class="insect-header">
        <h3 class="insect-name" id="insect-name">Nom Insecte</h3>
        <div class="insect-meta">
            <p id="insect-scientific" class="scientific-name">Nom latin</p>
            <p id="insect-taxonomy" class="taxonomy-info">Classification</p>
        </div>
    </div>

    <div class="insect-model-preview" id="insect-preview">
        <div class="model-placeholder">?</div>
    </div>

    <div class="insect-info-scroll">
        <div class="info-section">
            <h4>Rôle Écologique</h4>
            <p id="insect-role" class="educational-text">...</p>
        </div>

        <div class="info-section">
            <h4>Habitat Spécifique</h4>
            <p id="insect-habitat" class="educational-text">...</p>
        </div>

        <div class="info-section">
            <h4>Note du Naturaliste</h4>
            <p id="insect-anecdote" class="educational-text italic">...</p>
        </div>

        <div class="status-badge" id="insect-status">
            <span>Statut de conservation</span>
        </div>
    </div>
</div>

<script src="js/config.js"></script>
<script src="js/data-islands.js"></script>
<script src="js/game-settings.js"></script>

<!--CODE GÉNÉRÉ PAR IA-->
<script src="js/codeIA/MathUtils.js"></script>
<script src="js/codeIA/ParticleConfig.js"></script>
<script src="js/codeIA/BabylonHelpers.js"></script>

<script src="js/ui-manager.js"></script>
<script src="js/journal.js"></script>
<script src="js/scene-boat.js"></script>
<script src="js/scene-map.js"></script>
<script src="js/scene-island.js"></script>

<script src="js/app.js"></script>
</body>
</html>